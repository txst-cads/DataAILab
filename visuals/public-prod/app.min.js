console.log('ðŸŽ¯ CADS Research Visualization-Initializing...');const app={data:null,filteredData:null,searchIndex:null,clusterThemes:null,clusterCenters:null,deckgl:null,isLoading:true,currentZoom:8,elements:{loading:document.getElementById('loading'),loadingProgress:document.getElementById('loading-progress'),errorMessage:document.getElementById('error-message'),errorDetails:document.getElementById('error-details'),mapContainer:document.getElementById('map-container'),uiPanel:document.getElementById('ui-panel'),panelToggle:document.getElementById('panel-toggle'),searchInput:document.getElementById('search-input'),researcherFilter:document.getElementById('researcher-filter'),yearFilter:document.getElementById('year-filter'),yearDisplay:document.getElementById('year-display'),clusterFilter:document.getElementById('cluster-filter'),tooltip:document.getElementById('tooltip'),tooltipTitle:document.getElementById('tooltip-title'),tooltipDetails:document.getElementById('tooltip-details'),tooltipMeta:document.getElementById('tooltip-meta'),visiblePapers:document.getElementById('visible-papers'),totalPapers:document.getElementById('total-papers'),totalResearchers:document.getElementById('total-researchers'),totalClusters:document.getElementById('total-clusters')}};function init(){console.log('ðŸš€ Starting CADS Research Visualization...');setupUIEventListeners();updateLoadingProgress('Setting up interface...');loadVisualization()}function setupUIEventListeners(){app.elements.panelToggle.addEventListener('click',togglePanel);app.elements.yearFilter.addEventListener('input',(e)=>{app.elements.yearDisplay.textContent=e.target.value;applyFilters()});app.elements.searchInput.addEventListener('input',debounce((e)=>{performSearch(e.target.value)},300));app.elements.researcherFilter.addEventListener('change',(e)=>{applyFilters()});app.elements.clusterFilter.addEventListener('change',(e)=>{applyFilters()});document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){hideTooltip()}if(e.key==='/' && !e.target.matches('input')){e.preventDefault();app.elements.searchInput.focus()}})}function togglePanel(){const panel=app.elements.uiPanel;const button=app.elements.panelToggle;panel.classList.toggle('collapsed');button.textContent=panel.classList.contains('collapsed')? '+':'âˆ’';button.title=panel.classList.contains('collapsed')? 'Show panel':'Hide panel'}function updateLoadingProgress(message){app.elements.loadingProgress.textContent=message}function showError(title,details){app.elements.errorMessage.querySelector('.error-title').textContent=title;app.elements.errorDetails.textContent=details;app.elements.errorMessage.style.display='block';setTimeout(()=>{app.elements.errorMessage.style.display='none'},10000)}function hideLoading(){app.elements.loading.classList.add('hidden');app.isLoading=false;setTimeout(()=>{app.elements.loading.style.display='none'},300)}function showTooltip(x,y,title,details,meta){app.elements.tooltipTitle.textContent=title;app.elements.tooltipDetails.textContent=details;app.elements.tooltipMeta.textContent=meta;const tooltip=app.elements.tooltip;tooltip.style.display='block';const offsetX=15;const offsetY=15;let tooltipX=x+offsetX;let tooltipY=y+offsetY;tooltip.style.left=tooltipX+'px';tooltip.style.top=tooltipY+'px';const rect=tooltip.getBoundingClientRect();if(rect.right > window.innerWidth){tooltipX=x-rect.width-offsetX;tooltip.style.left=tooltipX+'px'}if(rect.bottom > window.innerHeight){tooltipY=y-rect.height-offsetY;tooltip.style.top=tooltipY+'px'}if(tooltipX < 0){tooltip.style.left='10px'}if(tooltipY < 0){tooltip.style.top='10px'}}function hideTooltip(){app.elements.tooltip.style.display='none'}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}async function loadVisualization(){try{updateLoadingProgress('Loading research data...');let response;try{response=await fetch('/data/visualization-data.json.gz');if(!response.ok)throw new Error('Compressed data not available')}catch(e){console.log('Loading uncompressed data...');response=await fetch('/data/visualization-data.json')}if(!response.ok){throw new Error(`Failed to load data:${response.status}`)}const data=await response.json();app.data=data;updateLoadingProgress('Loading cluster themes...');await loadClusterData();updateLoadingProgress('Processing data...');app.elements.totalPapers.textContent=data.meta.totalPapers.toLocaleString();app.elements.totalResearchers.textContent=data.meta.totalResearchers;app.elements.totalClusters.textContent=data.meta.totalClusters;populateFilters(data);updateLoadingProgress('Initializing visualization...');initializeDeckGL(data);updateLoadingProgress('Ready!');setTimeout(()=>{hideLoading();console.log('âœ… CADS Research Visualization-Loaded successfully!');console.log(`ðŸ“Š Displaying ${data.p.length}publications from ${data.r.length}researchers`)},300)}catch(error){console.error('Failed to load visualization:',error);showError('Loading Failed',`Could not load visualization data:${error.message}`);hideLoading()}}function populateFilters(data){const researcherSelect=app.elements.researcherFilter;data.r.forEach(researcher=>{const option=document.createElement('option');option.value=researcher.i;option.textContent=researcher.n;researcherSelect.appendChild(option)});const clusterSelect=app.elements.clusterFilter;data.c.forEach(cluster=>{const option=document.createElement('option');option.value=cluster.i;option.textContent=cluster.n;clusterSelect.appendChild(option)})}async function loadClusterData(){try{console.log('Loading cluster themes...');let themesResponse;try{themesResponse=await fetch('/data/cluster_themes.json.gz');if(!themesResponse.ok)throw new Error('Compressed themes not available')}catch(e){themesResponse=await fetch('/data/cluster_themes.json')}if(themesResponse.ok){const themesData=await themesResponse.json();app.clusterThemes=themesData.themes;console.log(`Loaded ${Object.keys(app.clusterThemes).length}cluster themes`)}else{console.warn('Failed to load cluster themes:',themesResponse.status)}console.log('Loading cluster centers...');let centersResponse;try{centersResponse=await fetch('/data/clustering_results.json.gz');if(!centersResponse.ok)throw new Error('Compressed centers not available')}catch(e){centersResponse=await fetch('/data/clustering_results.json')}if(centersResponse.ok){const centersData=await centersResponse.json();app.clusterCenters=centersData.cluster_info;console.log(`Loaded ${Object.keys(app.clusterCenters).length}cluster centers`)}else{console.warn('Failed to load cluster centers:',centersResponse.status)}}catch(error){console.warn('Could not load cluster data:',error)}}function initializeDeckGL(data){app.currentZoom=data.v.zoom;app.deckgl=new deck.DeckGL({container:'map-container',initialViewState:{longitude:data.v.longitude,latitude:data.v.latitude,zoom:data.v.zoom,pitch:0,bearing:0},controller:true,layers:createAllLayers(data,data.p),onHover:handleHover,onClick:handleClick,onViewStateChange:handleViewStateChange,getCursor:()=> 'crosshair'});app.elements.visiblePapers.textContent=data.p.length.toLocaleString()}function handleViewStateChange({viewState}){app.currentZoom=viewState.zoom;if(app.deckgl && app.data){const currentData=getCurrentFilteredData();app.deckgl.setProps({layers:createAllLayers(app.data,currentData)})}}function getCurrentFilteredData(){if(!app.data)return [];const researcherFilter=app.elements.researcherFilter.value;const clusterFilter=app.elements.clusterFilter.value;const yearFilter=parseInt(app.elements.yearFilter.value);let filteredData=app.data.p;if(researcherFilter){filteredData=filteredData.filter(p=> p.r===parseInt(researcherFilter))}if(clusterFilter){filteredData=filteredData.filter(p=> p.c===parseInt(clusterFilter))}if(yearFilter){filteredData=filteredData.filter(p=> p.y >=yearFilter)}return filteredData}function createAllLayers(fullData,publications){const layers=[createScatterplotLayerWithData(fullData,publications)];if(app.clusterThemes && app.clusterCenters && shouldShowLabels()){try{const labelLayer=createClusterLabelsLayer(fullData,publications);if(labelLayer){layers.push(labelLayer)}}catch(error){console.error('Error creating cluster labels layer:',error)}}return layers}function shouldShowLabels(){return app.currentZoom >=6}function createClusterLabelsLayer(fullData,publications){const visibleClusters=new Set(publications.map(p=> p.c).filter(c=> c !==-1));const labelData=[];visibleClusters.forEach(clusterId=>{const clusterInfo=app.clusterCenters[clusterId.toString()];const themeName=app.clusterThemes[clusterId.toString()];if(clusterInfo && themeName && clusterInfo.size >=15){labelData.push({position:clusterInfo.center,text:themeName,clusterId:clusterId,size:clusterInfo.size})}});console.log(`Creating cluster labels layer with ${labelData.length}labels`);if(!deck.TextLayer){console.warn('TextLayer not available in this Deck.gl version');return null}return new deck.TextLayer({id:'cluster-labels-layer',data:labelData,getPosition:d=> [d.position[0],d.position[1],1],getText:d=> d.text,getSize:d=> Math.max(12,Math.min(18,12+Math.log(d.size))),getColor:[255,255,255,200],fontFamily:'Arial,sans-serif',fontWeight:'bold',getTextAnchor:'middle',getAlignmentBaseline:'center',pickable:false,updateTriggers:{getPosition:publications,getText:app.clusterThemes}})}function createScatterplotLayerWithData(fullData,publications){return new deck.ScatterplotLayer({id:'publications-layer',data:publications,getPosition:d=> [d.pos[0],d.pos[1],0],getRadius:3,getFillColor:d=>{const researcher=fullData.r.find(r=> r.i===d.r);return researcher ? researcher.col:[128,128,128]},pickable:true,autoHighlight:true,radiusMinPixels:1,radiusMaxPixels:12,updateTriggers:{getFillColor:publications,getPosition:publications}})}function handleHover(info){if(info.object && info.x !==undefined && info.y !==undefined){const publication=info.object;const researcher=app.data.r.find(r=> r.i===publication.r);const cluster=app.data.c.find(c=> c.i===publication.c);const title=publication.t || 'Untitled';const details=`${researcher ? researcher.n:'Unknown Author'}â€¢ ${publication.y || 'Unknown Year'}`;const meta=`${publication.cit || 0}citations â€¢ ${cluster ? cluster.n:'Uncategorized'}`;showTooltip(info.x,info.y,title,details,meta)}else{hideTooltip()}}function handleClick(info){if(info.object){const publication=info.object;console.log('Clicked publication:',publication);if(publication.d){window.open(`https:}}}function applyFilters(){if(!app.deckgl || !app.data)return;const filteredData=getCurrentFilteredData();app.deckgl.setProps({layers:createAllLayers(app.data,filteredData)});app.elements.visiblePapers.textContent=filteredData.length.toLocaleString()}function performSearch(query){if(!query.trim()){applyFilters();return}console.log('Searching for:',query);applyFilters()}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init)}else{init()}window.CADSVisualization=app;window.showError=showError;